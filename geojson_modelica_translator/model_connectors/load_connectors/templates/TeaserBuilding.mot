within {{project_name}}.Loads.{{model_name}};
{% raw %}model building
  "n-zone RC building model based on URBANopt's use of TEASER export, with distribution pumps"
  extends Buildings.Experimental.DHC.Loads.BaseClasses.PartialBuilding(
    redeclare package Medium=MediumW,
    have_fan=false,
    have_eleHea=false,
    have_eleCoo=false);
  package MediumW=Buildings.Media.Water
    "Source side medium";
  package MediumA=Buildings.Media.Air
    "Load side medium";
  {% endraw %}parameter Integer nZon={{data['thermal_zones'] | count}}
    {% raw %} "Number of thermal zones";
  parameter Integer facSca=3
    "Scaling factor to be applied to each extensive quantity";
  {% endraw %}parameter Modelica.SIunits.TemperatureDifference delTBuiCoo={{ data['delta_temp_chw_building'] }}
    {% raw %} "Nominal building supply and return chilled water temperature difference";
  {% endraw %}parameter String weaName="modelica://{{project_name}}/Loads/{{data['load_resources_path']}}/{{data['mos_weather']['filename']}}"
    {% raw %} "Path of the weather file";
  Buildings.BoundaryConditions.WeatherData.ReaderTMY3 weaDat(
    calTSky=Buildings.BoundaryConditions.Types.SkyTemperatureCalculation.HorizontalRadiation,
    pAtm(
      displayUnit="Pa")=101339,
    filNam=Modelica.Utilities.Files.loadResource(
      weaName),
    computeWetBulbTemperature=true)
    "Weather data reader"
    annotation (Placement(transformation(extent={{10,-10},{-10,10}},rotation=90,origin={56,96})));
  {% endraw %}Buildings.Controls.OBC.CDL.Continuous.Sources.Constant minTSet[nZon](
    k=fill(
      {{ data['nominal_values']['temp_setpoint_heating']  }},
      nZon),
    y(
      each final unit="K",
      each displayUnit="degC"))
    "Minimum temperature set point"
    {% raw %} annotation (Placement(transformation(extent={{-290,230},{-270,250}})));
  {% endraw %}Buildings.Controls.OBC.CDL.Continuous.Sources.Constant maxTSet[nZon](
    k=fill(
      {{ data['nominal_values']['temp_setpoint_cooling']  }},
      nZon),
    y(
      each final unit="K",
      each displayUnit="degC"))
    "Maximum temperature set point"
    {% raw %} annotation (Placement(transformation(extent={{-290,190},{-270,210}})));
  {% endraw %}{% for zone in data['thermal_zones'] %}{{zone['model_name']}} {{zone['instance_name']}}
    annotation (Placement(transformation(extent={{zone['placement']}})));
  {% endfor %}Buildings.Controls.OBC.CDL.Continuous.MultiSum mulSum(
    nin=2) if have_pum
    {% raw %} annotation (Placement(transformation(extent={{260,70},{280,90}})));
  {% endraw %}Buildings.Experimental.DHC.Loads.Examples.BaseClasses.FanCoil4PipeHeatPorts terUni[nZon](
    redeclare each package Medium1=MediumW,
    redeclare each package Medium2=MediumA,
    each facSca=facSca,
    QHea_flow_nominal={{ data['nominal_heat_flow'][1]}},
    QCoo_flow_nominal={{ data['nominal_cool_flow'][1] }},
    each T_aLoaHea_nominal={{ data['nominal_values']['temp_setpoint_heating']  }},
    each T_aLoaCoo_nominal={{ data['nominal_values']['temp_setpoint_cooling']  }},
    each T_bHeaWat_nominal={{ data['nominal_values']['hhw_return_temp']  }},
    each T_bChiWat_nominal={{ data['nominal_values']['chw_return_temp']  }},
    each T_aHeaWat_nominal={{ data['nominal_values']['hhw_supply_temp']  }},
    each T_aChiWat_nominal={{ data['nominal_values']['chw_supply_temp']  }},
    each mLoaHea_flow_nominal=5,
    each mLoaCoo_flow_nominal=5)
    "Terminal unit"
    {% raw %} annotation (Placement(transformation(extent={{-200,-60},{-180,-40}})));
{% endraw %};
